@using Microsoft.AspNetCore.Hosting;
@inject IWebHostEnvironment hostingEnvironment;
@using Microsoft.AspNetCore.Http;
@inject IHttpContextAccessor httpContextAccessor;

@{
ViewData["Title"] = "Home Page";
var apiUrl = "";
@* var userId = httpContextAccessor.HttpContext.Request.Cookies["userId"]; *@
}

@{
  if (hostingEnvironment.IsDevelopment())
  {
    apiUrl = "https://localhost:7092/api/v1/";
  }
  else
  {
    apiUrl = "/api/v1/event";
  }
}

<div class="text-center">
   <h1 class="display-4">Welcome to SloveniaTrips</h1>
   <p>We help each other grow &lt;3</p>
</div>
<div id="event-list">

</div>

@section scripts
{
  <script>
    function getCookie(cookieName)
    {
      let cookie = {};
      document.cookie.split(';').forEach(function(el) {
        let [key,value] = el.split('=');
        cookie[key.trim()] = value;
      })
      return cookie[cookieName];
    }

    let userId = (getCookie("loginData"))
    let profileObject;
    //GET PROFILE DATA
    async function main()
    {
      await fetch("@apiUrl"+"profile/"+userId)
        .then(response => response.json())
        .then(profile =>{
          console.log(profile)
          profileObject = profile
        });
      console.log(profileObject.regionID)
      //check if local host
      await fetch("@apiUrl"+"event")
        .then(response => response.json())
        .then(events => {
          let eventList = document.getElementById("event-list");
          for (let i = 0; i < events.length; i++) {
            if(events[i].regionID == profileObject.regionID)
            {
              let event = events[i];
              let eventItem = document.createElement("div");
              eventItem.innerHTML = event.name+"<br>"+event.location+"<br>"+event.date+"<br><hr>";
              eventList.appendChild(eventItem);
            }
          }
        });
      await fetch("@apiUrl"+"eventhasactivity")
        .then(response => response.json())
        .then(eventhasactivity =>{
          console.log(eventhasactivity)
        });
      await fetch("@apiUrl"+"activity")
        .then(response => response.json())
        .then(activity =>{
          console.log(activity)
        });
    }
    main();

  </script>
}
<div class="con1">
   <div class="con2">
      <div style="border: 1px solid black; width:500px;height:500px;margin-top:10px;float:left">Edin<br>Ćehić<br>Osrednjeslovenska regija<br>Obiskani dogodki: Dražba za umetnine 19.st</div>
   </div>
   <div class="con3">
        <div style="display:flex">
            <div style="border: 1px solid black; height:75px;width:500px;margin-top:10px;margin-left:150px ">Muzej<br>Ilirska Bistrica<br>30.12.2022 ob 12:30</div>
            <div style="border: 1px solid red; height:25px;width:30px;margin-top:60px; margin-left:10px;"></div>
            <div style="border: 1px solid green; height:25px;width:30px;margin-top:60px; margin-left:10px"></div>
        </div>
        <div style="display:flex">
      <div style="border: 1px solid black; height:75px;width:500px;margin-top:10px; margin-left:150px">Galerija<br>Logatec<br>28.11.2022 ob 17:00</div>
            <div style="border: 1px solid red; height:25px;width:30px;margin-top:60px; margin-left:10px;"></div>
            <div style="border: 1px solid green; height:25px;width:30px;margin-top:60px; margin-left:10px"></div>
        </div>
        <div style="display:flex">
      <div style="border: 1px solid black; height:75px;width:500px;margin-top:10px; margin-left:150px">Dražba<br>Jesenice<br>20.5.2022 ob 9:30</div>
            <div style="border: 1px solid red; height:25px;width:30px;margin-top:60px; margin-left:10px;"></div>
            <div style="border: 1px solid green; height:25px;width:30px;margin-top:60px; margin-left:10px"></div>
        </div>
        <div style="display:flex">
      <div style="border: 1px solid black; height:75px;width:500px;margin-top:10px; margin-left:150px">Lutkovna predstava<br>Tržič<br>5.1.2023 ob 19:15</div>
            <div style="border: 1px solid red; height:25px;width:30px;margin-top:60px; margin-left:10px;"></div>
            <div style="border: 1px solid green; height:25px;width:30px;margin-top:60px; margin-left:10px"></div>
        </div>
        <div style="display:flex">
            <div style="border: 1px solid black; height:75px;width:500px;margin-top:10px;margin-left:150px ">Muzej<br>Ilirska Bistrica<br>30.12.2022 ob 12:30</div>
            <div style="border: 1px solid red; height:25px;width:30px;margin-top:60px; margin-left:10px;"></div>
            <div style="border: 1px solid green; height:25px;width:30px;margin-top:60px; margin-left:10px"></div>
        </div>
        <div style="display:flex">
      <div style="border: 1px solid black; height:75px;width:500px;margin-top:10px; margin-left:150px">Muzej<br>Razstava avtov v času Jugoslavije<br>5.2.2023 ob 10:30</div>
            <div style="border: 1px solid red; height:25px;width:30px;margin-top:60px; margin-left:10px;"></div>
            <div style="border: 1px solid green; height:25px;width:30px;margin-top:60px; margin-left:10px"></div>
        </div>
      
   </div>
</div>